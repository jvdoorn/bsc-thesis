% !TEX root = ../../thesis.tex
% Method largely based on Frolov 2004.
% Uses a superconducting loop with a junction inductively coupled to a dc-SQUID magnetometer

Our method is mostly inspired by \Citeauthor{frolovMeasurementCurrentPhaseRelation2004} \citeyear{frolovMeasurementCurrentPhaseRelation2004}. We incorporate the junction whose CPR we want to measure into a superconducting loop. This loop is then inductively coupled to a dc-SQUID magnetometer. See Fig. \ref{fig:schematic-setup} for a schematic of the setup. This chapter will outline the ideas behind the setup and provide arguments for the chosen geometries.

\begin{figure}
	\centering
	\begin{circuitikz}
		% Main loop with single Josephson Junction (openbarrier) and an inductor for clarity.
		\draw (0,0) to [short, *-, i=$I_t$] (2,0)
		to [josephsonjunction, i=$I_s$, l_=$JJ$] (2, -2)
		to [short, -*, i=$I_t$] (0, -2);
		\draw (2,0) to [short, i=$I_l$] (4, 0)
		to [inductor, l_=$L_l$] (4, -2)
		to [short] (2, -2);

		% Secondary loop with a dc-SQUID.
		\draw (5, 0) to [josephsonjunction] (7, 0)
		to [short] (7, -2)
		to [josephsonjunction] (5, -2)
		to [inductor, l_=$L_s$] (5, 0);

		% Annotate flux through the loops
		\node[] at (3,-1) {$\Phi_l$};
		\node[] at (6,-1) {$\Phi_s$};
	\end{circuitikz}

	\caption{Schematic depiction of the system. The left loop is inductively coupled to the dc-SQUID on the right. This is illustrated by $L_l$ and $L_s$. The junction itself has an inductance $L_{JJ}$. The current $I_t$ is controlled externally. The flux through the two loops is denoted by $\Phi_l$ and $\Phi_s$. The junction whose CPR we want to measure is part of the left loop. Please note that the 4 contacts used for the dc-SQUID readout are not shown.}
	\label{fig:schematic-setup}
\end{figure}

\section{Relation between flux and phase}
Using flux quantization and the gauge-invariant phase we can derive a relation between the flux $\Phi_l$ and $\gamma$. For details please see Section \ref{app:derivation-phase-flux-relation}.
\begin{equation}
	\gamma = \frac{2\pi}{\Phi_0}\left(\Phi_l + \lambda^2\mu_0 \int \vec{J}\cdot d \vec{l} \right)
	\label{eqn:phase-flux-relation}
\end{equation}
We can express $\Phi_l$ in terms of $I_s$ and $I_l$:
\begin{equation}
	\Phi_l = I_sL_{JJ}  + I_lL_l
\end{equation}
Where $L_{JJ}$ and $L_l$ are the inductances of the Josephson junction and loop respectively\footnote{This is not the so called Josephson inductance but purely a magnetic inductance and not a kinetic inductance.}. We will assume that $L_{JJ} \ll L_l$, this is also done by \citeauthor{frolovMeasurementCurrentPhaseRelation2004} (see \cite{frolovCurrentphaseRelationsJosephson2005,frolovMeasurementCurrentPhaseRelation2004}) and often in literature when discussing dc-SQUIDs (see par example \cite{clarkeSQUIDHandbook2004}). This means our final equation for the loop flux becomes:
\begin{equation}
	\Phi_l = I_lL_l
\end{equation}

\subsection{Figure of merit}
\label{sec:figure-of-merit}
In order for $\gamma$ to be proportional to $\Phi_l$ the second term must be negligible in Eq. \ref{eqn:phase-flux-relation}. We define a figure of merit $\delta$ which we require to be $\ll 1$.
\begin{equation}
	\delta = \frac{\lambda^2\mu_0 \int \vec{J}\cdot d \vec{l}}{\Phi_l}
\end{equation}
For a square and round geometry we can rewrite the integral part in the following way:
\begin{equation}
	\int \vec{J}\cdot d \vec{l} = \begin{cases}
		2\pi r \tilde{j} I_l, &\text{round} \\
		8r \tilde{j} I_l, &\text{square}
	\end{cases}
\end{equation}
Here $r$ is the radius (half the diameter) and $\tilde{j} = \tilde{j}(d, w, \lambda)$ a geometric factor in \unit{\per\square\meter}. The value of $\tilde{j}$ can be calculated numerically and details can be found in Section \ref{app:derivation-geometric-factor-j}.

The loop flux can simply be rewritten as $\Phi_l = I_lL_l$, this allows us to rewrite the figure of merit as:
\begin{equation}
	\delta = \frac{\lambda^2\mu_0\tilde{j}}{L_l} \cdot \begin{cases}
		2\pi r, &\text{round} \\
		8r, &\text{square}
	\end{cases}
	\label{eqn:figure-of-merit}
\end{equation}

It is important to note that the figure of merit is independent of the amount of current ($I_l$) passed through the loop, as such it is always valid. The inductance of the loop can be determined using a simulation done in SuperScreen\cite{bishop-vanhornSuperScreenOpensourcePackage2022}.

\subsection{Magnetic coupling}
\label{sec:magnetic-coupling}
There is not a $1:1$ relation between $\Phi_l$ and $\Phi_s$. We can calculate the mutual inductance between the two numerically. To do so we calculate the magnetic field created by a current through the junction loop and determining the magnetic flux through the dc-SQUID loop. This gives us the mutual inductance $M$. We define the coupling factor $\kappa$ such that:
\begin{equation}
	M = \kappa \sqrt{L_lL_s}
\end{equation}
Here we again assume that $L_{JJ} \ll L_l$. We now see that the magnetic fluxes are connected through the following relation:
\begin{equation}
	\Phi_l = \kappa \sqrt{\frac{L_l}{L_s}}\Phi_s \Leftrightarrow \Phi_s = \kappa \sqrt{\frac{L_s}{L_l}}\Phi_l
\end{equation}
This is a naive approach that does not take into account the possibility of magnetic lensing\cite{prigozhin3DSimulationSuperconducting2018}. Thus $\kappa$ is a `minimal' coupling between the two. As long as $\kappa$ is sufficiently large enough our method should work.

\section{Sample geometries}
Our method will make use of constriction junctions (ScS)\footnote{Also called a Dayem bridge, see \citeauthor{likharevSuperconductingWeakLinks1979} \citeyear{likharevSuperconductingWeakLinks1979}.} as these are fairly easy to construct. Following our figure of merit in Eq. \ref{eqn:figure-of-merit}, we benefit from a small London penetration depth. The size of our junction is determined by the value of $\xi$ and should be on the order of $3\xi$\cite{likharevSuperconductingWeakLinks1979} to make a single-valued CPR. Based on this and the available superconductors we have chosen for \ce{Nb}\footnote{$\lambda = \qty{39}{\nano\meter}$, $\xi = \qty{38}{\nano\meter}$ and $T_c \approx \qty{7.5}{\kelvin}$. Characteristic lengths attributed to R. Meservey and B. B. Schwartz and critical temperature based on measurements on a \ce{Nb}-thin film in our own lab.}. See Tab. \ref{tab:target-geometries} for the used geometries. For our calculations we used a thickness (height) of \qty{100}{\nano\meter} and a spacing between the two loops of \qty{200}{\nano\meter}. See Tab. \ref{tab:estimated-factors} for the results of the calculations.

\begin{table}
	\centering
	\begin{tabular}{@{}lrr@{}}
		\toprule
		Loop & Inner diameter [\unit{\micro\meter}] &  Outer diameter [\unit{\micro\meter}] \\ \midrule
		main  & 1.40  & 2.00 \\
		dc-SQUID & 1.15 & 1.38 \\
		\bottomrule
	\end{tabular}
	\caption{Geometries used in the calculation of the figure of merit and coupling factor. The geometries of the dc-SQUID are based on earlier work by \citeauthor{rogSQUIDontipMagneticMicroscopy2022} \citeyear{rogSQUIDontipMagneticMicroscopy2022}.}
	\label{tab:target-geometries}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{@{}lr@{}}
		\toprule
		Parameter & Value \\
		\midrule
		mutual inductance ($M$) & \qty{-6.834e-02}{\pico\henry} \\
		main loop inductance ($L_l$) & \qty{1.938e+00}{\pico\henry} \\
		dc-SQUID inductance ($L_s$) & \qty{1.969e+00}{\pico\henry} \\
		coupling constant ($\kappa$) & -0.035 \\
		figure of merit ($\delta$) & 0.00015 \\
		\bottomrule
	\end{tabular}
	\caption{Estimated parameters of the system based on the geometries in Tab. \ref{tab:target-geometries} and using a thickness (height) of \qty{100}{\nano\meter} and a spacing between the two loops of \qty{200}{\nano\meter}.}
	\label{tab:estimated-factors}
\end{table} 

\subsection{Sample fabrication}
\label{sec:method-sample-fabrication}
The course structures such as contact pads are created using lithography. We use dc-sputtering to deposit a \qty{\pm 90}{\nano\meter} layer of \ce{Nb} on top of a resist coated \ce{Si} wafer. As \ce{Nb} is very sensitive to contamination we additionally cap it using dc-sputtered \qty{7}{\nano\meter} layer of \ce{Au}.

The junctions and loops are created by a focussed ion beam (FIB) that etches away the layers of \ce{Nb} and \ce{Au}. The advantage of this method over creating these fine structures using lithography is the higher resolution of the FIB and less contamination of the \ce{Nb} from the resist.

The junction type we use is a constriction junction. The relevant parameter is $\xi$. By choosing the width of the constriction on the order of $3\xi$ we can control the junction behaviour due to the temperature dependence of $\xi$\cite{tinkhamIntroductionSuperconductivity}. Details on the sample geometries will be given on a per sample basis in later sections as these are highly dependent on alignments and drift.

\section{Analysis method}
Our method requires little to no analysis, which immediately highlights one of the benefits of this method. This section mainly recaps how to retrieve the CPR, $f(\gamma)$, from the measured quantities $I_t$ (which is controlled in the experiment) and $\Phi_s$.

Starting from our Eq. \ref{eqn:phase-flux-relation}, the expression for $\Phi_l$ and applying Ohms laws to the circuit in Fig. \ref{fig:schematic-setup} we have:
\begin{equation}
	\gamma = \frac{2\pi}{\Phi_0}\Phi_l \qquad \Phi_l = I_lL_l \qquad I_t = I_s + I_l
\end{equation}
Here we have neglected the term $\lambda^2\mu_0 \int \vec{J}\cdot d \vec{l}$ assuming our figure or merit is sufficiently small as highlighted in Sec. \ref{sec:figure-of-merit}. Using these relations and recalling $I_s = I_cf(\gamma)$ we see that:
\begin{align}
	I_t &= I_s + \frac{\Phi_l}{L_l} \nonumber \\
	    &= I_c f(\gamma) + \frac{\Phi_0}{2\pi L_l}\gamma
\end{align}
This means that a linear trend is added on top of our CPR. Furthermore we have a final step where $\gamma$ is related to $\Phi_s$ based on Sec. \ref{sec:magnetic-coupling}.

\begin{equation}
	\gamma = \frac{2\pi}{\Phi_0}\Phi_l = \kappa \sqrt{\frac{L_l}{L_s}} \frac{2\pi}{\Phi_0} \Phi_s
\end{equation}
Since $f(\gamma)$ must be $2\pi$-periodic we can easily map these two even if $\kappa$, $L_l$ and $L_s$ are not know exactly. This is the only data analysis we need to do based on unknown parameters. See Figure~\ref{fig:analytical-prediction} for an expectation curve.

\subsection{Hysteresis}
A loop with a single junction is sometimes called an rf-SQUID\cite{clarkeSQUIDHandbook2004}. The screening parameter\footnote{Normally when referring to the screening parameter we mean $\beta_l = 2LI_c/\Phi_0$. However, this is for a `normal' dc-SQUID and not an rf-SQUID.},
\begin{equation}
	\beta_{\text{rf}} = \frac{2\pi I_c L_l}{\Phi_0}
\end{equation}
where $I_c$ refers to the critical current of the junction, must be less than one for a non-hysteric $I_s\Phi_l$-curve\cite{clarkeSQUIDHandbook2004,frolovMeasurementCurrentPhaseRelation2004}. This gives a maximum value for the critical current, $I_{c,\text{max}}$ given $L_l$. We note however, based on an numerical calculation, that for an SNS-junction $\beta_{\text{rf}} < 0.9$ is a more trustworthy criterium, see Figure~\ref{fig:CPR-hysteresis}. This is because the CPR is not perfectly sinusoidal\cite{vermeerSTMbasedScanningSQUID2021,likharevSuperconductingWeakLinks1979}.

\begin{figure}[ht]
	\begin{subfigure}[t]{0.45\textwidth}
		\centering
		\input{figures/simulations/CPR_prediction.pgf}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.45\textwidth}
		\centering
		\input{figures/simulations/measurement_prediction.pgf}
	\end{subfigure}

	\caption{Expectation values for the CPR of an SNS junction. The calculations where done for $I_c=\qty{25}{\micro\ampere}$, $L_l=\qty{11}{\pico\henry}$ and $\Delta(T)$ estimated at \qty{1}{\milli\electronvolt}. We note that the current through the loop creates a linear background that gets modulated by the CPR of the junction.}
	\label{fig:analytical-prediction}
\end{figure}

\begin{figure}
	\centering
	\import{figures/simulations}{CPR_hysteresis.pgf}
	\caption{Data produced based on the same parameters as Figure~\ref{fig:analytical-prediction}. This time however we modulated $I_c$ between $0.5I_{c,\text{max}}$ (blue) and $1.5I_{c,\text{max}}$ (red) in steps of $0.1I_{c,\text{max}}$. The black line highlights $I_c=I_{c,\text{max}}$. The black line is still slightly hysteric, the reason for this is given in the main text.}
	\label{fig:CPR-hysteresis}
\end{figure}